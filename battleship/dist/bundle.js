(()=>{"use strict";const t=Object.freeze({PLAYER1_TURN:0,PLAYER2_TURN:1,GAME_OVER:2});var e=document.createElement("div");e.classList.add("container"),e.id="gameplay-container",e.innerHTML='\n    <h1>Battleship</h1>\n    <h2 id="status-text">Player 1\'s Turn</h2>\n\n    <div id="enemy-board"></div>\n    <div id="your-status">\n        <h3>Current Status:</h3>\n        <div id="your-board"></div>\n    </div>\n\n    <div id="popup-text">\n        <p>SHIP SUNK!</p>\n    </div>\n';const n=e;function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}function i(t){var e=function(t){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}var a=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._type=e.name,this._length=e.length,this._hits=0},(e=[{key:"type",get:function(){return this._type}},{key:"hits",get:function(){return this._hits}},{key:"hit",value:function(){this._hits++}},{key:"isSunk",get:function(){return this._hits>=this._length}}])&&o(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const u=Object.freeze({NORTH:0,EAST:1,SOUTH:2,WEST:3}),c=Object.freeze({CARRIER:{length:5,name:"Carrier"},BATTLESHIP:{length:4,name:"Battleship"},DESTROYER:{length:3,name:"Destroyer"},SUBMARINE:{length:3,name:"Submarine"},PATROL_BOAT:{length:2,name:"Patrol Boat"}});function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,u=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,y(r.key),r)}}function y(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}var p=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._board=this.createBoard(),this._ships=[]},(e=[{key:"board",get:function(){return this._board}},{key:"createBoard",value:function(){for(var t=[],e=0;e<10;e++){t.push([]);for(var n=0;n<10;n++)t[e].push({ship:null,hit:!1})}return t}},{key:"_resetBoard",value:function(){this._board=this.createBoard(),this._ships=[]}},{key:"placeShip",value:function(t,e,n){var r=this,o=s(n,2),i=o[0],u=o[1],c=this._calculateShipPositions(t.length,e,i,u);if(!c)return!1;var l=new a(t);return c.forEach(function(t){var e=s(t,2),n=e[0],o=e[1];r.board[o][n]={ship:l,hit:!1}}),this._ships.push(l),!0}},{key:"calculateRandomPlacements",value:function(){var t=this;this._resetBoard();var e=[c.CARRIER,c.BATTLESHIP,c.DESTROYER,c.SUBMARINE,c.PATROL_BOAT],n=[u.NORTH,u.SOUTH,u.EAST,u.WEST],r=this.board.length,o=[];return e.forEach(function(e){for(var i=!1,a=0;!i;){if(++a>500)throw new Error("Failed to generate a valid layout (too many attempts).");var u=n[Math.floor(Math.random()*n.length)],c=Math.floor(Math.random()*r),l=Math.floor(Math.random()*r);try{t.placeShip(e,u,[c,l])&&(o.push({type:e,direction:u,origin:[c,l]}),i=!0)}catch(t){}}}),o}},{key:"_calculateShipPositions",value:function(t,e,n,r){for(var o=[],i=n,a=r,c=0;c<t;c++){if(i<0||i>9||a<0||a>9||null!==this.board[a][i].ship)return null;switch(o.push([i,a]),e){case u.EAST:i--;break;case u.WEST:i++;break;case u.NORTH:a++;break;case u.SOUTH:a--;break;default:return null}}return o}},{key:"receiveAttack",value:function(t){var e=s(t,2),n=e[0],r=e[1];if("number"!=typeof n||"number"!=typeof r)return!1;if(n<0||n>9||r<0||r>9)return!1;var o=this.board[r][n];return!o.hit&&(o.hit=!0,o.ship&&o.ship.hit(),!0)}},{key:"remainingShips",value:function(){return this._ships.filter(function(t){return!t.isSunk}).length}}])&&d(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,m(r.key),r)}}function m(t){var e=function(t){if("object"!=h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}var v=function(){return t=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e,this._gameboard=n},(e=[{key:"name",get:function(){return this._name}},{key:"gameboard",get:function(){return this._gameboard}},{key:"attack",value:function(t,e){return t.receiveAttack(e)}}])&&b(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_(r.key),r)}}function _(t){var e=function(t){if("object"!=g(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==g(e)?e:e+""}function A(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(A=function(){return!!t})()}function T(){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=P(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},T.apply(null,arguments)}function P(t){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},P(t)}function w(t,e){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},w(t,e)}var O=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e,n){return e=P(e),function(t,e){if(e&&("object"==g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,A()?Reflect.construct(e,n||[],P(t).constructor):e.apply(t,n))}(this,e,[t]))._toAttack=n._buildAttackOptions(),n._prevSuccess=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(e,t),n=e,r=[{key:"_buildAttackOptions",value:function(){for(var t=[],e=0;e<10;e++)for(var n=0;n<10;n++)t.push([n,e]);return t}},{key:"attack",value:function(t){var n,r,o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getPosition();return!!(n=e,r=this,o=T(P(n.prototype),"attack",r),"function"==typeof o?function(t){return o.apply(r,t)}:o)([t,i])&&(t.board[i[1]][i[0]].ship&&(this._prevSuccess=i),[!0,i])}},{key:"_getPosition",value:function(){if(null!==this._prevSuccess){var t=this._getAdjacentPosition();if(null!==t)return t}var e=Math.floor(Math.random()*this._toAttack.length),n=this._toAttack[e];return this._toAttack.splice(0|e,1),n}},{key:"_getAdjacentPosition",value:function(){for(var t,e=this,n=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,u=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return S(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this._prevSuccess,2),r=n[0],o=n[1],i=[[r+1,o],[r-1,o],[r,o+1],[r,o-1]],a=function(){var t=i[u],n=e._toAttack.findIndex(function(e){return e[0]===t[0]&&e[1]===t[1]});if(-1!==n)return e._toAttack.splice(n,1),{v:t}},u=0;u<4;u++)if(t=a())return t.v;return this._prevSuccess=null,null}}],r&&E(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(v);function R(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,u=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return k(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var L=function(e){var r,o,i,a,u,c=(e=e||{}).onGameOver||null,l=t.PLAYER1_TURN,s=new Map,f=function(){s.forEach(function(t,e){e.removeEventListener("click",t)}),s.clear()},d=function(t,e,n,r){n.board[e][t].hit=!0,n.board[e][t].ship&&n.board[e][t].ship.isSunk?u.update(l,n.board[e][t],r,n.board[e][t].ship.type):u.update(l,n.board[e][t],r),setTimeout(function(){p()},1e3)},y=function(){f(),u.render(l);var e=l===t.PLAYER1_TURN?a:i,n=l===t.PLAYER1_TURN?r:o;"CPU_Player"===n.constructor.name?(document.querySelector("#enemy-board").style.pointerEvents="none",setTimeout(function(){!function(t,e){for(var n=t.attack(e),r=1;!1===n[0]&&r<100;)n=t.attack(e),r++;if(!n[0])throw new Error("No more valid attacks for CPU player");var o=R(n[1],2),i=o[0],a=o[1],u=document.querySelector("[data-x='".concat(i,"'][data-y='").concat(a,"']"));d(i,a,e,u)}(n,e)},1500*Math.random()+500)):document.querySelectorAll("button:not([disabled])").forEach(function(t){var n=Number.parseInt(t.getAttribute("data-x")),r=Number.parseInt(t.getAttribute("data-y")),o=function(){return function(t,e,n){var r=R(t,2),o=r[0],i=r[1];e.receiveAttack([o,i])&&d(o,i,e,n)}([n,r],e,t)};s.set(t,o),t.addEventListener("click",o)})},p=function(){var e=i.remainingShips(),n=a.remainingShips();0!==e&&0!==n?(l=l===t.PLAYER1_TURN?t.PLAYER2_TURN:t.PLAYER1_TURN)!==t.PLAYER1_TURN&&l!==t.PLAYER2_TURN||y():(l=t.GAME_OVER,f(),c&&c({winner:0===e?o:r,loser:0===e?r:o,state:l}))};return{init:function(){r=new v("Player",e.p1board),o=new O("Computer"),i=r.gameboard,(a=o.gameboard).calculateRandomPlacements({}),u=function(e,r){document.body.innerHTML="",document.body.appendChild(n);var o=document.getElementById("status-text"),i=document.getElementById("enemy-board"),a=document.getElementById("your-board"),u=document.querySelector("#popup-text"),c=e.gameboard.board,l=r.gameboard.board,s=[],f=[];return{init:function(e){var n=this;this._clearBoards(),[{board:c,tiles:s,isCurrentPlayer:e===t.PLAYER1_TURN},{board:l,tiles:f,isCurrentPlayer:e===t.PLAYER2_TURN}].forEach(function(t){var r=t.board,o=t.tiles,i=t.isCurrentPlayer;n._initBoard(r,o,i,e)}),i.style.pointerEvents="initial"},_clearBoards:function(){s.length=0,f.length=0,a.innerHTML="",i.innerHTML=""},_initBoard:function(t,e,n,r){var o=this,u=n?a:i;t.forEach(function(t,i){t.forEach(function(t,a){var c=o._createTile(n);o._setTileAttributes(c,a,i),o._updateTileState(c,t,n,r),e.push(c),u.appendChild(c)})})},_createTile:function(t){return t?document.createElement("div"):document.createElement("button")},_setTileAttributes:function(t,e,n){t.setAttribute("data-x",e),t.setAttribute("data-y",n)},_updateTileState:function(t,e,n,r){e.ship&&n&&t.classList.add("ship"),e.hit&&(t.classList.add("hit"),e.ship&&t.classList.add("ship"),!n&&(t.disabled=!0))},render:function(n){this.init(n);var u=n===t.PLAYER1_TURN?e:r,c="CPU_Player"===u.constructor.name;c?document.querySelector("#your-status").style.display="none":document.querySelector("#your-status").removeAttribute("style"),o.innerText="".concat(u.name,"'s turn"),u===e?(c||s.forEach(function(t){a.appendChild(t)}),f.forEach(function(t){i.appendChild(t)})):u===r&&(c||f.forEach(function(t){a.appendChild(t)}),s.forEach(function(t){i.appendChild(t)}))},update:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null!==r&&(u.classList.add("show"),u.innerHTML="<p>".concat(r," sunk!</p>").toUpperCase(),setTimeout(function(){u.classList.remove("show")},1e3)),i.style.pointerEvents="none",n.classList.add("hit"),e.ship&&n.classList.add("ship")}}}(r,o),y()},p1:r,p2:o}};var j=document.createElement("div");j.classList.add("container"),j.id="create-game-container",j.innerHTML='\n    <h1>Battleship</h1>\n    <h2 id="status-text">Place your ships</h2>\n\n    <div id="your-board"></div>\n    \n    <div id="buttons">\n        <button id="randomise-btn">↺</button>\n        <button id="start-btn">Start</button>\n    </div>\n';const C=j,M=function(t){document.body.innerHTML="",document.body.appendChild(C);var e=document.getElementById("your-board"),n=document.getElementById("randomise-btn"),r=document.getElementById("start-btn"),o=new p,i=[],a=function(){var t;i.length=0,e&&(e.innerHTML=""),t=o.board,e&&t.forEach(function(t,n){t.forEach(function(t,r){var o=document.createElement("div");!function(t,e,n){t.setAttribute("data-x",e),t.setAttribute("data-y",n)}(o,r,n),function(t,e){e.ship&&t.classList.add("ship"),t.classList.remove("hit")}(o,t),i.push(o),e.appendChild(o)})})},u=function(){(o=new p).calculateRandomPlacements(),a()};return n&&n.addEventListener("click",function(){u()}),r&&r.addEventListener("click",function(){"function"==typeof t&&t(o)}),{init:function(){u(),a()}}};(new function(){t.PLAYER1_TURN;var e={createGame:function(){new M(function(t){e.playGame(t)}).init()},gameOver:function(n){t.GAME_OVER,function(t,e){var n,r;document.body.innerHTML="",document.body.appendChild((n=t.winner.name,(r=document.createElement("div")).classList.add("container"),r.id="gameover-container",r.innerHTML="\n        <h1>Game Over!</h1>\n        <h2>".concat(n," Wins!</h2>\n        <button>Restart?</button>\n    "),r)),document.querySelector("button").addEventListener("click",function(){e()})}(n,function(){return e.createGame()})},playGame:function(t){new L({p1board:t,onGameOver:function(t){return e.gameOver(t)}}).init()}};return e}).createGame()})();